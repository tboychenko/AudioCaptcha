@{
    ViewBag.Title = "Index";
}

<div id="playerDiv" class="jp-jplayer"></div>
<div id="jp_container_1" class="jp-audio">
    <div class="jp-type-single">
        <div class="jp-gui jp-interface">
            <ul class="jp-controls">
                <li><a href="javascript:;" class="jp-play" tabindex="1">play</a></li>
                <li><a href="javascript:;" id="pauseButton" class="jp-pause" tabindex="1">pause</a></li>
            </ul>
        </div>
        <div class="jp-no-solution">
            <span>Update Required</span>
            To play the media you will need to either update your browser to a recent version or update your <a href="http://get.adobe.com/flashplayer/" target="_blank">Flash plugin</a>.
        </div>
    </div>
</div>

<br />
@Html.TextBox("audioAnswer")
<br />
<div id="errorLabel" style="display: none; color: red;">Введено неверное число!</div>
@Html.TextBox("trickyLabel", (string)@ViewBag.numberHash, new { style = "display: none;"})
<br />

<input type="button" id="checkButton" value="Проверить" />

<script type="text/javascript">
    $(document).ready(function () {
        $("#playerDiv").jPlayer({
            ready: function () {
                $(this).jPlayer("setMedia", {
                    mp3: "@ViewBag.audioPath"
                });
            },
            swfPath: "/Scripts",
            supplied: "mp3",
            cssSelector: {
                pause: '#pauseButton'
            }
        });

        $('#pauseButton').click(function () {
            $('#playerDiv').jPlayer('stop');
        });

        $("#checkButton").click(function () {
            $.ajax({
                url: "/Home/Check",
                cache: false,
                type: "POST",
                data: {
                    answer: $("#audioAnswer").val(),
                    numberHash: $("#trickyLabel").val()
                },
                dataType: "json",
                success: function (data) {
                    if (data.success) {
                        alert("Всё верно!");
                        $('#errorLabel').hide();
                    } else {
                        $('#errorLabel').show();
                    }
                    refreshCaptcha();
                },
                error: function () {
                    alert("Не удалось сохранить данные!");
                    refreshCaptcha();
                }
            });
        });
    });

    refreshCaptcha = function () {

    }
</script>



